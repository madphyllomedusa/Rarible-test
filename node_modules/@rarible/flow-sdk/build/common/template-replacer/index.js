"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fillCodeTemplate = exports.replaceImportAddresses = void 0;
var prefix_1 = require("../prefix");
var REGEXP_IMPORT = /(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g;
var replaceImportAddresses = function (code, addressMap, byName) {
    if (byName === void 0) { byName = true; }
    var topShotFeeAddress = addressMap.TopShotFee;
    var addTopShowFee = code.replace(/0xTOPSHOTFEE/g, topShotFeeAddress);
    return addTopShowFee.replace(REGEXP_IMPORT, function (__, imp, contract, _, address) {
        var key = byName ? contract : address;
        var nextAddress = addressMap instanceof Function ? addressMap(key) : addressMap[key];
        var addressWithPrefix = (0, prefix_1.withPrefix)(nextAddress);
        if (!addressWithPrefix) {
            throw new Error("Invalid contract address for injecting in transaction");
        }
        return "".concat(imp).concat(contract, " from ").concat(addressWithPrefix);
    });
};
exports.replaceImportAddresses = replaceImportAddresses;
function fillCodeTemplate(code, map) {
    var resultCode = code;
    Object.keys(map).forEach(function (key) {
        resultCode = resultCode.replace(new RegExp(key, "g"), map[key]);
    });
    return resultCode;
}
exports.fillCodeTemplate = fillCodeTemplate;
