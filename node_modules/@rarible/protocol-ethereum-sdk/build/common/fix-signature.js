"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fixSignature = void 0;
var ethereumjs_util_1 = require("ethereumjs-util");
function fixSignature(sig) {
    if (sig !== undefined) {
        var buf = hexToBuffer(sig);
        if (buf.length === 65) {
            var v = (0, ethereumjs_util_1.bufferToInt)(buf.slice(64));
            if (v < 27) {
                var r = buf.slice(0, 32);
                var s = buf.slice(32, 64);
                return toRpcSig(v + 27, r, s);
            }
            else {
                return sig;
            }
        }
        else {
            return sig;
        }
    }
    else {
        return sig;
    }
}
exports.fixSignature = fixSignature;
function hexToBuffer(hex) {
    if (hex.startsWith("0x")) {
        return Buffer.from(hex.substring(2), "hex");
    }
    else {
        return Buffer.from(hex, "hex");
    }
}
function toRpcSig(v, r, s) {
    return (0, ethereumjs_util_1.bufferToHex)(Buffer.concat([(0, ethereumjs_util_1.setLengthLeft)(r, 32), (0, ethereumjs_util_1.setLengthLeft)(s, 32), (0, ethereumjs_util_1.toBuffer)(v)]));
}
