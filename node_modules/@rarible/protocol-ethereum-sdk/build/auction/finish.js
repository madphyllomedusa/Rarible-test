"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.finishAuction = void 0;
var tslib_1 = require("tslib");
var auction_1 = require("./contracts/auction");
function finishAuction(ethereum, send, config, apis, hash) {
    return (0, tslib_1.__awaiter)(this, void 0, void 0, function () {
        var auction;
        return (0, tslib_1.__generator)(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!ethereum) {
                        throw new Error("Wallet is undefined");
                    }
                    return [4 /*yield*/, apis.auction.getAuctionByHash({ hash: hash })];
                case 1:
                    auction = _a.sent();
                    validateFinishAuction(auction);
                    return [2 /*return*/, send((0, auction_1.createEthereumAuctionContract)(ethereum, config.auction)
                            .functionCall("finishAuction", auction.auctionId))];
            }
        });
    });
}
exports.finishAuction = finishAuction;
function validateFinishAuction(auction) {
    if (!auction.lastBid) {
        throw new Error("Auction without bid can't be finished");
    }
    if (auction.endTime) {
        var endTime = new Date(auction.endTime).getTime();
        if (endTime > 0 && endTime < Date.now()) {
            throw new Error("Auction is not finished");
        }
    }
}
